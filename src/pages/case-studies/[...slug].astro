---
import Base from "../../layouts/Base.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import CTA from "../../components/CTA.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const studies = await getCollection("case-studies");
  return studies.map((study) => ({
    params: { slug: study.slug },
    props: { study },
  }));
}

const { study } = Astro.props;
const { Content } = await study.render();
---

<Base title={study.data.title} description={study.data.challenge} image={study.data.image}>
  <Header />
  <main class="flex-1">
    <!-- Back Link -->
    <div class="container-narrow pt-6">
      <a href="/case-studies" class="inline-flex items-center gap-1 text-sm text-neutral-600 hover:text-primary transition-colors">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
        Back to Case Studies
      </a>
    </div>

    <!-- Case Study Header -->
    <div class="bg-purple-950 text-white py-16 lg:py-24 mt-4">
      <div class="container-narrow">
        <div class="flex items-center gap-3 mb-4">
          <span class="text-xs font-bold uppercase tracking-wider bg-white/10 px-3 py-1 rounded">{study.data.service}</span>
          <span class="text-xs opacity-70">{study.data.industry}</span>
        </div>
        <h1 class="text-3xl lg:text-5xl mb-4 text-white">{study.data.title}</h1>
        <p class="text-lg opacity-80">Client: {study.data.client}</p>
      </div>
    </div>

    {study.data.image && (
      <div class="container-narrow -mt-8 mb-12 relative z-10">
        <img src={study.data.image} alt={study.data.title} class="w-full rounded-lg shadow-lg" />
      </div>
    )}

    <!-- Key Metrics Bar -->
    {study.data.results.length > 0 && (
      <section class="py-8 bg-purple-50">
        <div class="container-site">
          <div class="flex flex-wrap justify-center gap-8 lg:gap-16">
            {study.data.results.map((result) => (
              <div class="text-center">
                <p class="text-lg font-bold text-primary">{result}</p>
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Challenge / Solution / Results Summary -->
    <section class="section-padding">
      <div class="container-site">
        <div class="grid md:grid-cols-3 gap-6">
          <div class="card p-8 border-t-4" style="border-top-color: var(--color-error);">
            <h3 class="text-sm font-bold uppercase tracking-wider mb-4" style="color: var(--color-error);">Challenge</h3>
            <p class="text-neutral-800 leading-relaxed">{study.data.challenge}</p>
          </div>
          <div class="card p-8 border-t-4 border-primary">
            <h3 class="text-sm font-bold uppercase tracking-wider text-primary mb-4">Solution</h3>
            <p class="text-neutral-800 leading-relaxed">{study.data.solution}</p>
          </div>
          <div class="card p-8 border-t-4" style="border-top-color: var(--color-teal);">
            <h3 class="text-sm font-bold uppercase tracking-wider mb-4" style="color: var(--color-teal);">Results</h3>
            <ul class="space-y-2">
              {study.data.results.map((result) => (
                <li class="flex items-start gap-2 text-neutral-800">
                  <svg class="w-5 h-5 text-teal shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                  {result}
                </li>
              ))}
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Full Case Study Content -->
    <div class="container-narrow py-12 lg:py-16 prose prose-lg max-w-none prose-headings:font-normal prose-a:text-primary prose-a:no-underline hover:prose-a:underline">
      <Content />
    </div>

    <CTA title="Ready to Become Our Next Success Story?" />
  </main>
  <Footer />
</Base>
