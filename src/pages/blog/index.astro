---
import Page from "../../layouts/Page.astro";
import Hero from "../../components/Hero.astro";
import BlogCard from "../../components/BlogCard.astro";
import CTA from "../../components/CTA.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog", ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const categories = [
  { label: "All", value: "all" },
  { label: "EOS", value: "eos" },
  { label: "Strategy", value: "strategy" },
  { label: "Team Health", value: "team-health" },
  { label: "Fractional", value: "fractional" },
];
---

<Page title="Blog" description="Insights on EOS implementation, strategy, team health, and scaling founder-led businesses in Asia.">
  <Hero
    title="Insights for Founder-Led Growth"
    subtitle="Practical advice on EOS, strategy, team health, and scaling your business."
    eyebrow="Blog"
    image="/images/heroes/hero-services.jpg"
  />

  <!-- Category Filters -->
  <section class="py-8 border-b border-neutral-200">
    <div class="container-site">
      <div class="flex flex-wrap gap-2" id="category-filters">
        {categories.map((cat) => (
          <button
            class="filter-btn px-4 py-2 text-sm rounded-full border border-neutral-200 hover:border-primary hover:text-primary transition-colors"
            data-category={cat.value}
          >
            {cat.label}
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- Blog Grid -->
  <section class="section-padding">
    <div class="container-site">
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8" id="blog-grid">
        {posts.map((post) => (
          <div data-category={post.data.category}>
            <BlogCard
              title={post.data.title}
              summary={post.data.summary}
              date={post.data.date}
              author={post.data.author}
              category={post.data.category}
              image={post.data.image}
              slug={post.slug}
            />
          </div>
        ))}
      </div>

      <div id="no-results" class="hidden text-center py-16 text-neutral-600">
        No posts found in this category.
      </div>
    </div>
  </section>

  <CTA title="Let's Build the Systems That Match Your Vision" />
</Page>

<script>
  const buttons = document.querySelectorAll<HTMLButtonElement>(".filter-btn");
  const cards = document.querySelectorAll<HTMLElement>("#blog-grid > div");
  const noResults = document.getElementById("no-results");
  const grid = document.getElementById("blog-grid");

  function setActive(category: string) {
    buttons.forEach((btn) => {
      const isActive = btn.dataset.category === category;
      btn.classList.toggle("bg-primary", isActive);
      btn.classList.toggle("text-white", isActive);
      btn.classList.toggle("border-primary", isActive);
    });

    let visible = 0;
    cards.forEach((card) => {
      const show = category === "all" || card.dataset.category === category;
      card.classList.toggle("hidden", !show);
      if (show) visible++;
    });

    if (noResults && grid) {
      noResults.classList.toggle("hidden", visible > 0);
      grid.classList.toggle("hidden", visible === 0);
    }
  }

  buttons.forEach((btn) => {
    btn.addEventListener("click", () => setActive(btn.dataset.category || "all"));
  });

  setActive("all");
</script>
